<%= form_with model: [@project, @estimate], local: true, class: "space-y-6", data: { controller: "tabs", tabs_active_class: "tab-active", tabs_inactive_class: "tab-inactive" } do |f| %>
  <% if @estimate.errors.any? %>
    <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
      <h3 class="text-red-800 font-medium">入力エラーがあります</h3>
      <ul class="mt-2 text-red-700 text-sm list-disc list-inside">
        <% @estimate.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- タブナビゲーション -->
  <div class="border-b border-gray-200">
    <nav class="-mb-px flex space-x-8" id="estimate-tabs">
      <button type="button" class="tab-link tab-active" data-tabs-target="tab" data-action="click->tabs#select" data-tab-name="cover">表紙</button>
      <button type="button" class="tab-link tab-inactive" data-tabs-target="tab" data-action="click->tabs#select" data-tab-name="items">内訳明細</button>
      <button type="button" class="tab-link tab-inactive" data-tabs-target="tab" data-action="click->tabs#select" data-tab-name="budget">予算明細</button>
      <button type="button" class="tab-link tab-inactive" data-tabs-target="tab" data-action="click->tabs#select" data-tab-name="confirmation">確認書</button>
      <button type="button" class="tab-link tab-inactive" data-tabs-target="tab" data-action="click->tabs#select" data-tab-name="conditions">条件書</button>
    </nav>
  </div>

  <!-- タブ1: 表紙 -->
  <div id="tab-cover" class="tab-content" data-tabs-target="panel">
    <%= render "estimates/form_cover", f: f %>
  </div>

  <!-- タブ2: 内訳明細 -->
  <div id="tab-items" class="tab-content hidden" data-tabs-target="panel">
    <%= render "estimates/form_items", f: f %>
  </div>

  <!-- タブ3: 予算明細 -->
  <div id="tab-budget" class="tab-content hidden" data-tabs-target="panel">
    <%= render "estimates/form_budget", f: f %>
  </div>

  <!-- タブ4: 確認書 -->
  <div id="tab-confirmation" class="tab-content hidden" data-tabs-target="panel">
    <%= render "estimates/form_confirmation", f: f %>
  </div>

  <!-- タブ5: 条件書 -->
  <div id="tab-conditions" class="tab-content hidden" data-tabs-target="panel">
    <%= render "estimates/form_conditions", f: f %>
  </div>

  <!-- 送信ボタン -->
  <div class="flex justify-end gap-4 pt-4 border-t">
    <%= link_to "キャンセル", @estimate.persisted? ? project_estimate_path(@project, @estimate) : project_estimates_path(@project),
        class: "btn-secondary" %>
    <%= f.submit @estimate.persisted? ? "更新" : "作成", class: "btn-primary" %>
  </div>
<% end %>
