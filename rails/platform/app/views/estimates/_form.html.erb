<%= form_with model: [@project, @estimate], local: true, class: "space-y-6" do |f| %>
  <% if @estimate.errors.any? %>
    <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
      <h3 class="text-red-800 font-medium">入力エラーがあります</h3>
      <ul class="mt-2 text-red-700 text-sm list-disc list-inside">
        <% @estimate.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- タブナビゲーション -->
  <div class="border-b border-gray-200">
    <nav class="-mb-px flex space-x-8" id="estimate-tabs">
      <a href="#" class="tab-link tab-active" data-tab="cover">表紙</a>
      <a href="#" class="tab-link tab-inactive" data-tab="items">内訳明細</a>
      <a href="#" class="tab-link tab-inactive" data-tab="confirmation">確認書</a>
      <a href="#" class="tab-link tab-inactive" data-tab="conditions">条件書</a>
    </nav>
  </div>

  <!-- タブ1: 表紙 -->
  <div id="tab-cover" class="tab-content">
    <%= render "estimates/form_cover", f: f %>
  </div>

  <!-- タブ2: 内訳明細 -->
  <div id="tab-items" class="tab-content hidden">
    <%= render "estimates/form_items", f: f %>
  </div>

  <!-- タブ3: 確認書 -->
  <div id="tab-confirmation" class="tab-content hidden">
    <%= render "estimates/form_confirmation", f: f %>
  </div>

  <!-- タブ4: 条件書 -->
  <div id="tab-conditions" class="tab-content hidden">
    <%= render "estimates/form_conditions", f: f %>
  </div>

  <!-- 送信ボタン -->
  <div class="flex justify-end gap-4 pt-4 border-t">
    <%= link_to "キャンセル", @estimate.persisted? ? project_estimate_path(@project, @estimate) : project_estimates_path(@project),
        class: "btn-secondary" %>
    <%= f.submit @estimate.persisted? ? "更新" : "作成", class: "btn-primary" %>
  </div>
<% end %>

<style>
  .tab-link { padding-bottom: 1rem; border-bottom-width: 2px; border-bottom-style: solid; font-weight: 500; font-size: 0.875rem; cursor: pointer; }
  .tab-active { border-color: #3b82f6; color: #3b82f6; }
  .tab-inactive { border-color: transparent; color: #6b7280; }
  .tab-inactive:hover { border-color: #d1d5db; color: #374151; }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.tab-link').forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const tabName = this.dataset.tab;

        // Hide all tabs
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.add('hidden');
        });

        // Deactivate all links
        document.querySelectorAll('.tab-link').forEach(l => {
          l.classList.remove('tab-active');
          l.classList.add('tab-inactive');
        });

        // Show selected tab
        document.getElementById('tab-' + tabName).classList.remove('hidden');

        // Activate selected link
        this.classList.remove('tab-inactive');
        this.classList.add('tab-active');
      });
    });
  });
</script>
