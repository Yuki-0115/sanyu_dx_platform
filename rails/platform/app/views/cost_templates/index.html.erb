<div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
  <div class="mb-8">
    <h1 class="text-2xl font-bold text-gray-900">日報用原価テンプレート</h1>
    <p class="text-sm text-gray-500 mt-1">職長が日報入力時に参照する単価表を管理します</p>
  </div>

  <!-- 2カード横並び -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
    <!-- 基本単価カード -->
    <div class="bg-white rounded-lg shadow overflow-hidden border-t-4 border-blue-500">
      <div class="p-5">
        <div class="flex justify-between items-start">
          <div>
            <h2 class="text-lg font-bold text-gray-900">基本単価</h2>
            <p class="text-xs text-gray-500 mt-0.5">全案件共通の標準単価</p>
          </div>
          <%= link_to base_cost_templates_path,
              class: "px-3 py-1.5 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 whitespace-nowrap" do %>
            管理
          <% end %>
        </div>

        <% if @base_templates.any? %>
          <div class="mt-4 space-y-2">
            <% @base_templates_by_category.each do |cat, templates| %>
              <div class="flex items-center justify-between py-1.5 px-3 bg-gray-50 rounded">
                <span class="text-sm font-medium text-gray-700"><%= BaseCostTemplate::CATEGORY_LABELS[cat] %></span>
                <span class="text-sm text-gray-500"><%= templates.count %>件</span>
              </div>
            <% end %>
          </div>
          <div class="mt-3 pt-3 border-t text-right">
            <span class="text-sm font-medium text-gray-900">合計 <%= @base_templates.count %>件</span>
          </div>
        <% else %>
          <div class="mt-4 py-6 text-center">
            <p class="text-sm text-gray-400">未登録</p>
            <%= link_to "最初の単価を登録", new_base_cost_template_path, class: "text-sm text-blue-600 hover:underline" %>
          </div>
        <% end %>
      </div>
    </div>

    <!-- 現場単価カード -->
    <div class="bg-white rounded-lg shadow overflow-hidden border-t-4 border-orange-500">
      <div class="p-5">
        <div>
          <h2 class="text-lg font-bold text-gray-900">現場単価</h2>
          <p class="text-xs text-gray-500 mt-0.5">基本単価と異なる場合に案件ごとに設定</p>
        </div>

        <div class="mt-4 space-y-2">
          <div class="flex items-center justify-between py-1.5 px-3 bg-gray-50 rounded">
            <span class="text-sm font-medium text-gray-700">登録済み案件</span>
            <span class="text-sm text-gray-500"><%= @projects_with_templates.count %>件</span>
          </div>
          <div class="flex items-center justify-between py-1.5 px-3 bg-gray-50 rounded">
            <span class="text-sm font-medium text-gray-700">未登録案件</span>
            <span class="text-sm text-gray-500"><%= @projects_without_templates.count %>件</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 案件別一覧 -->
  <% if @projects_with_templates.any? || @projects_without_templates.any? %>
    <div class="bg-white rounded-lg shadow overflow-hidden">
      <div class="px-5 py-4 border-b bg-gray-50">
        <h2 class="font-semibold text-gray-800">案件別 現場単価</h2>
      </div>
      <table class="w-full text-sm">
        <thead class="bg-gray-50 border-b">
          <tr>
            <th class="px-4 py-2.5 text-left font-medium text-gray-500">案件</th>
            <th class="px-4 py-2.5 text-center font-medium text-gray-500 w-24">登録数</th>
            <th class="px-4 py-2.5 text-center font-medium text-gray-500 w-24">操作</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
          <% @projects_with_templates.each do |project| %>
            <% templates = project.project_cost_templates %>
            <tr class="hover:bg-gray-50">
              <td class="px-4 py-2.5">
                <span class="font-mono text-xs text-gray-400 mr-2"><%= project.code %></span>
                <%= link_to project.name, project_path(project), class: "text-gray-900 hover:text-blue-600" %>
              </td>
              <td class="px-4 py-2.5 text-center">
                <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                  <%= templates.count %>
                </span>
              </td>
              <td class="px-4 py-2.5 text-center">
                <%= link_to "管理", project_project_cost_templates_path(project),
                    class: "text-blue-600 hover:text-blue-800 text-xs font-medium" %>
              </td>
            </tr>
          <% end %>
          <% @projects_without_templates.each do |project| %>
            <tr class="hover:bg-gray-50">
              <td class="px-4 py-2.5">
                <span class="font-mono text-xs text-gray-400 mr-2"><%= project.code %></span>
                <span class="text-gray-500"><%= project.name %></span>
              </td>
              <td class="px-4 py-2.5 text-center">
                <span class="text-xs text-gray-400">-</span>
              </td>
              <td class="px-4 py-2.5 text-center">
                <%= link_to "登録", new_project_project_cost_template_path(project),
                    class: "text-gray-500 hover:text-blue-600 text-xs" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% end %>

  <% if @projects.empty? && @base_templates.empty? %>
    <div class="bg-white rounded-lg shadow p-8 text-center text-gray-500">
      <p>対象となるデータがありません</p>
      <p class="text-sm mt-2">まずは基本単価を登録してください</p>
    </div>
  <% end %>
</div>
