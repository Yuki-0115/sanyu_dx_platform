<div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
  <div class="flex justify-between items-center mb-6">
    <div>
      <h1 class="text-2xl font-bold text-gray-900"><%= @fiscal_year %>年度 対比表</h1>
      <p class="text-sm text-gray-500"><%= @fiscal_year %>年度 vs <%= @fiscal_year - 1 %>年度（前年比較）</p>
    </div>
    <div class="flex space-x-2">
      <%= link_to "月次一覧", monthly_profit_losses_path,
          class: "inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50" %>
      <%= link_to "年度別", yearly_profit_losses_path(fiscal_year: @fiscal_year),
          class: "inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50" %>
      <%= link_to "推移表", trend_profit_losses_path(fiscal_year: @fiscal_year),
          class: "inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50" %>
    </div>
  </div>

  <%# 年度選択 %>
  <div class="mb-6 flex items-center space-x-4">
    <label class="text-sm font-medium text-gray-700">年度選択:</label>
    <div class="flex space-x-2">
      <% @fiscal_years.each do |fy| %>
        <%= link_to "#{fy}年度",
            fiscal_year_comparison_profit_losses_path(fiscal_year: fy),
            class: "px-3 py-1 rounded-md text-sm #{fy == @fiscal_year ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}" %>
      <% end %>
    </div>
  </div>

  <%# 年度合計対比 %>
  <div class="bg-white shadow rounded-lg overflow-hidden mb-6">
    <div class="px-4 py-3 border-b border-gray-200 bg-indigo-50">
      <h3 class="text-lg font-medium text-indigo-900">年度合計 対比</h3>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">項目</th>
            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase"><%= @fiscal_year - 1 %>年度</th>
            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase"><%= @fiscal_year %>年度</th>
            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">増減額</th>
            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">増減率</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          <tr class="bg-blue-50">
            <td class="px-4 py-3 text-sm font-medium text-gray-900">売上高</td>
            <td class="px-4 py-3 text-sm text-right text-gray-700"><%= number_to_currency(@comparison[:previous][:revenue], unit: "¥", precision: 0) %></td>
            <td class="px-4 py-3 text-sm text-right text-gray-900 font-medium"><%= number_to_currency(@comparison[:current][:revenue], unit: "¥", precision: 0) %></td>
            <td class="px-4 py-3 text-sm text-right <%= @comparison[:diff][:revenue] >= 0 ? 'text-green-600' : 'text-red-600' %>">
              <%= @comparison[:diff][:revenue] >= 0 ? '+' : '' %><%= number_to_currency(@comparison[:diff][:revenue], unit: "¥", precision: 0) %>
            </td>
            <td class="px-4 py-3 text-sm text-right <%= @comparison[:rate][:revenue] >= 0 ? 'text-green-600' : 'text-red-600' %>">
              <%= @comparison[:rate][:revenue] >= 0 ? '+' : '' %><%= @comparison[:rate][:revenue] %>%
            </td>
          </tr>
          <tr>
            <td class="px-4 py-3 text-sm text-gray-700">変動費</td>
            <td class="px-4 py-3 text-sm text-right text-gray-600"><%= number_to_currency(@comparison[:previous][:variable_cost], unit: "¥", precision: 0) %></td>
            <td class="px-4 py-3 text-sm text-right text-gray-700"><%= number_to_currency(@comparison[:current][:variable_cost], unit: "¥", precision: 0) %></td>
            <td class="px-4 py-3 text-sm text-right <%= @comparison[:diff][:variable_cost] <= 0 ? 'text-green-600' : 'text-red-600' %>">
              <%= @comparison[:diff][:variable_cost] >= 0 ? '+' : '' %><%= number_to_currency(@comparison[:diff][:variable_cost], unit: "¥", precision: 0) %>
            </td>
            <td class="px-4 py-3 text-sm text-right text-gray-500">-</td>
          </tr>
          <tr>
            <td class="px-4 py-3 text-sm text-gray-700">固定費</td>
            <td class="px-4 py-3 text-sm text-right text-gray-600"><%= number_to_currency(@comparison[:previous][:fixed_cost], unit: "¥", precision: 0) %></td>
            <td class="px-4 py-3 text-sm text-right text-gray-700"><%= number_to_currency(@comparison[:current][:fixed_cost], unit: "¥", precision: 0) %></td>
            <td class="px-4 py-3 text-sm text-right <%= @comparison[:diff][:fixed_cost] <= 0 ? 'text-green-600' : 'text-red-600' %>">
              <%= @comparison[:diff][:fixed_cost] >= 0 ? '+' : '' %><%= number_to_currency(@comparison[:diff][:fixed_cost], unit: "¥", precision: 0) %>
            </td>
            <td class="px-4 py-3 text-sm text-right text-gray-500">-</td>
          </tr>
          <tr class="bg-orange-50">
            <td class="px-4 py-3 text-sm font-medium text-gray-900">原価計</td>
            <td class="px-4 py-3 text-sm text-right text-gray-700"><%= number_to_currency(@comparison[:previous][:total_cost], unit: "¥", precision: 0) %></td>
            <td class="px-4 py-3 text-sm text-right text-gray-900 font-medium"><%= number_to_currency(@comparison[:current][:total_cost], unit: "¥", precision: 0) %></td>
            <td class="px-4 py-3 text-sm text-right <%= @comparison[:diff][:total_cost] <= 0 ? 'text-green-600' : 'text-red-600' %>">
              <%= @comparison[:diff][:total_cost] >= 0 ? '+' : '' %><%= number_to_currency(@comparison[:diff][:total_cost], unit: "¥", precision: 0) %>
            </td>
            <td class="px-4 py-3 text-sm text-right text-gray-500">-</td>
          </tr>
          <tr class="bg-green-50">
            <td class="px-4 py-3 text-sm font-bold text-gray-900">粗利</td>
            <td class="px-4 py-3 text-sm text-right <%= @comparison[:previous][:gross_profit] >= 0 ? 'text-green-600' : 'text-red-600' %>">
              <%= number_to_currency(@comparison[:previous][:gross_profit], unit: "¥", precision: 0) %>
            </td>
            <td class="px-4 py-3 text-sm text-right font-bold <%= @comparison[:current][:gross_profit] >= 0 ? 'text-green-700' : 'text-red-700' %>">
              <%= number_to_currency(@comparison[:current][:gross_profit], unit: "¥", precision: 0) %>
            </td>
            <td class="px-4 py-3 text-sm text-right font-medium <%= @comparison[:diff][:gross_profit] >= 0 ? 'text-green-600' : 'text-red-600' %>">
              <%= @comparison[:diff][:gross_profit] >= 0 ? '+' : '' %><%= number_to_currency(@comparison[:diff][:gross_profit], unit: "¥", precision: 0) %>
            </td>
            <td class="px-4 py-3 text-sm text-right font-medium <%= @comparison[:rate][:gross_profit] >= 0 ? 'text-green-600' : 'text-red-600' %>">
              <%= @comparison[:rate][:gross_profit] >= 0 ? '+' : '' %><%= @comparison[:rate][:gross_profit] %>%
            </td>
          </tr>
          <tr>
            <td class="px-4 py-3 text-sm text-gray-700">利益率</td>
            <td class="px-4 py-3 text-sm text-right <%= @comparison[:previous][:profit_rate] >= 0 ? 'text-green-600' : 'text-red-600' %>">
              <%= @comparison[:previous][:profit_rate] %>%
            </td>
            <td class="px-4 py-3 text-sm text-right font-medium <%= @comparison[:current][:profit_rate] >= 0 ? 'text-green-700' : 'text-red-700' %>">
              <%= @comparison[:current][:profit_rate] %>%
            </td>
            <td class="px-4 py-3 text-sm text-right <%= (@comparison[:current][:profit_rate] - @comparison[:previous][:profit_rate]) >= 0 ? 'text-green-600' : 'text-red-600' %>">
              <%= (@comparison[:current][:profit_rate] - @comparison[:previous][:profit_rate]) >= 0 ? '+' : '' %><%= (@comparison[:current][:profit_rate] - @comparison[:previous][:profit_rate]).round(1) %>pt
            </td>
            <td class="px-4 py-3 text-sm text-right text-gray-500">-</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <%# 月別対比 %>
  <div class="bg-white shadow rounded-lg overflow-hidden">
    <div class="px-4 py-3 border-b border-gray-200 bg-gray-50">
      <h3 class="text-lg font-medium text-gray-900">月別 対比</h3>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase" rowspan="2">月</th>
            <th class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase border-b" colspan="2">売上高</th>
            <th class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase border-b" colspan="2">粗利</th>
          </tr>
          <tr class="bg-gray-100">
            <th class="px-3 py-2 text-right text-xs text-gray-500"><%= @fiscal_year - 1 %>年度</th>
            <th class="px-3 py-2 text-right text-xs text-gray-500"><%= @fiscal_year %>年度</th>
            <th class="px-3 py-2 text-right text-xs text-gray-500"><%= @fiscal_year - 1 %>年度</th>
            <th class="px-3 py-2 text-right text-xs text-gray-500"><%= @fiscal_year %>年度</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          <% @comparison[:monthly].each do |data| %>
            <tr class="hover:bg-gray-50">
              <td class="px-3 py-2 text-sm font-medium text-gray-900"><%= data[:month] %>月</td>
              <td class="px-3 py-2 text-sm text-right text-gray-600"><%= number_to_currency(data[:previous][:revenue], unit: "", precision: 0, delimiter: ",") %></td>
              <td class="px-3 py-2 text-sm text-right text-gray-900">
                <%= number_to_currency(data[:current][:revenue], unit: "", precision: 0, delimiter: ",") %>
                <% if data[:diff_revenue] != 0 %>
                  <span class="text-xs <%= data[:diff_revenue] >= 0 ? 'text-green-600' : 'text-red-600' %>">
                    (<%= data[:diff_revenue] >= 0 ? '+' : '' %><%= number_to_currency(data[:diff_revenue], unit: "", precision: 0, delimiter: ",") %>)
                  </span>
                <% end %>
              </td>
              <td class="px-3 py-2 text-sm text-right <%= data[:previous][:gross_profit] >= 0 ? 'text-green-600' : 'text-red-600' %>">
                <%= number_to_currency(data[:previous][:gross_profit], unit: "", precision: 0, delimiter: ",") %>
              </td>
              <td class="px-3 py-2 text-sm text-right <%= data[:current][:gross_profit] >= 0 ? 'text-green-700' : 'text-red-700' %> font-medium">
                <%= number_to_currency(data[:current][:gross_profit], unit: "", precision: 0, delimiter: ",") %>
                <% if data[:diff_profit] != 0 %>
                  <span class="text-xs <%= data[:diff_profit] >= 0 ? 'text-green-600' : 'text-red-600' %>">
                    (<%= data[:diff_profit] >= 0 ? '+' : '' %><%= number_to_currency(data[:diff_profit], unit: "", precision: 0, delimiter: ",") %>)
                  </span>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
        <tfoot class="bg-gray-100">
          <tr class="font-bold">
            <td class="px-3 py-3 text-sm text-gray-900">年度計</td>
            <td class="px-3 py-3 text-sm text-right text-gray-700"><%= number_to_currency(@comparison[:previous][:revenue], unit: "", precision: 0, delimiter: ",") %></td>
            <td class="px-3 py-3 text-sm text-right text-gray-900"><%= number_to_currency(@comparison[:current][:revenue], unit: "", precision: 0, delimiter: ",") %></td>
            <td class="px-3 py-3 text-sm text-right <%= @comparison[:previous][:gross_profit] >= 0 ? 'text-green-600' : 'text-red-600' %>">
              <%= number_to_currency(@comparison[:previous][:gross_profit], unit: "", precision: 0, delimiter: ",") %>
            </td>
            <td class="px-3 py-3 text-sm text-right <%= @comparison[:current][:gross_profit] >= 0 ? 'text-green-700' : 'text-red-700' %>">
              <%= number_to_currency(@comparison[:current][:gross_profit], unit: "", precision: 0, delimiter: ",") %>
            </td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>

  <p class="mt-4 text-xs text-gray-500">※ ()内は前年同月比の増減額</p>
</div>
