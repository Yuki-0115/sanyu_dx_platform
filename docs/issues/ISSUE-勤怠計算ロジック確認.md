# 勤怠計算ロジックの確認・調整

## 概要
現在実装した勤怠時間の自動計算ロジックについて、社労士・事務員と打ち合わせを行い、実務に即した形に調整する必要がある。

## 現在の実装内容

### 時間帯の定義
- 基本就業時間: 08:00〜17:00
- 残業時間: 05:00〜08:00、17:00〜22:00
- 深夜時間: 22:00〜05:00

### 休憩時間の差し引きロジック
- **日勤パターン**（基本時間がある場合）: 基本→残業→深夜の順で差し引き
- **夜勤パターン**（基本時間がない場合）: 最も長い時間帯から差し引き

### 計算例
| パターン | 出勤 | 退勤 | 休憩 | 基本 | 残業 | 深夜 |
|----------|------|------|------|------|------|------|
| 通常勤務 | 08:00 | 17:00 | 60分 | 8:00 | - | - |
| 残業あり | 08:00 | 20:00 | 60分 | 8:00 | 3:00 | - |
| 深夜作業 | 14:00 | 23:00 | 60分 | 2:00 | 5:00 | 1:00 |
| 長時間勤務 | 06:00 | 22:00 | 90分 | 7:30 | 7:00 | - |
| 夜勤 | 22:00 | 06:00 | 60分 | - | 1:00 | 6:00 |

## 確認が必要な項目

### 1. 時間帯の定義
- [ ] 基本就業時間は08:00〜17:00で正しいか？
- [ ] 深夜割増は22:00〜05:00で正しいか？
- [ ] 早朝（05:00〜08:00）は残業扱いで正しいか？

### 2. 休憩時間の取り扱い
- [ ] 休憩時間のデフォルト値（60分）は適切か？
- [ ] 休憩の差し引き順序は実務に合っているか？
- [ ] 夜勤の休憩時間の差し引き方は適切か？

### 3. 変則パターンへの対応
- [ ] 日勤→夜勤→日勤のような変則パターンはどう計算するか？
- [ ] 手動で時間を上書きできる現在の仕様で問題ないか？

### 4. 給与計算との連携
- [ ] 割増率（残業1.25倍、深夜1.25倍、深夜残業1.5倍など）の扱い
- [ ] 法定休日・所定休日の区別は必要か？
- [ ] 36協定との整合性確認

### 5. CSV出力フォーマット
- [ ] 給与ソフトへの取り込み形式の確認
- [ ] 必要な項目の過不足確認

## 関連ファイル
- `app/models/attendance.rb` - 計算ロジック
- `app/views/attendance_sheets/employee_detail.html.erb` - 勤怠詳細表示
- `app/javascript/controllers/attendance_time_controller.js` - リアルタイム計算

## 打ち合わせ後のアクション
- [ ] 時間帯定義の修正（必要に応じて）
- [ ] 休憩差し引きロジックの調整
- [ ] CSV出力フォーマットの調整
- [ ] 給与計算連携の実装

## 担当
- [ ] 社労士との打ち合わせ日程調整
- [ ] 事務員へのヒアリング

---
作成日: 2026-01-19
ステータス: 打ち合わせ待ち
